<link rel="stylesheet" href="styles.css">

<html>
<header><title>This is title</title></header>
<body>
<p id="p1">Hello world<p>
<div id="content"></div>
</body>
</html>
<script src="d3.js"></script>
<script>
let result
async function foo(){

    const data = {
            'sql' : 'SELECT * FROM acme limit 3'
        };
    const other_params = {
        headers : { "content-type" : "application/json; charset=UTF-8" },
        body : JSON.stringify(data),
        method : "POST",
        mode : "cors"
    };

    fetch("http://127.0.0.1:5000/api/db", other_params)
        .then(function(response) {
            if (response.ok) {
                return response.json();
            } else {
                throw new Error("Could not reach the API: " + response.statusText);
            }
        }).then(function(data) {
            obj = JSON.parse(data)
    
            result = obj
            columns = [];
            for (let [key, value] of Object.entries(result)) {
                columns.push({name: key, type: value['name']});
            }
            // document.getElementById("p1").innerHTML = columns;
            let selection = d3.select('#content').selectAll('p').data(columns)
            selection.enter().append('p').merge(selection).classed('column', true)
                .text(function(d) { return d.name + " type: " + d.type; });
            selection.exit().remove();
        })
        .catch(function(error) {
            document.getElementById("p1").innerHTML = "error " + error.message;
        });



    // let obj = await (await fetch("http://127.0.0.1:5000/api/db")).json()
    
}
foo()
</script>
