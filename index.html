<!DOCTYPE html>
<html>
<head>
<title>Page Title</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="styles.css">
</head>
<body>

<!-- Note -->
<!-- <div style="background:yellow;padding:5px">
  <h4 style="text-align:center">Resize the browser window to see the responsive effect.</h4>
</div> -->

<!-- Header -->
<!-- <div class="header">
  <h1>My Website</h1>
  <p>With a <b>flexible</b> layout.</p>
</div> -->

<!-- Navigation Bar -->
<!-- <div class="navbar">
  <a href="#">Link</a>
  <a href="#">Link</a>
  <a href="#">Link</a>
  <a href="#">Link</a>
</div> -->

<!-- The flexible grid (content) -->
<div class="row">
  <div class="side">
    <textarea class="input" id="sql" autofocus>SELECT * FROM acme limit 3</textarea>
    <p></p>
    <button type="button" onclick="myFunction()">Submit SQL</button>
    <p class="error" id='sqlerror'></p>
    <div id="content"></div>
    <!-- <h2>About Me</h2>
    <h5>Photo of me:</h5>
    <div class="fakeimg" style="height:200px;">Image</div>
    <p>Some text about me in culpa qui officia deserunt mollit anim..</p>
    <h3>More Text</h3>
    <p>Lorem ipsum dolor sit ame.</p>
    <div class="fakeimg" style="height:60px;">Image</div><br>
    <div class="fakeimg" style="height:60px;">Image</div><br>
    <div class="fakeimg" style="height:60px;">Image</div> -->
  </div>
  <div class="main">
    <h2>TITLE HEADING</h2>
    <h5>Title description, Dec 7, 2017</h5>
    <div class="fakeimg" style="height:200px;">Image</div>
    <p>Some text..</p>
    <p>Sunt in culpa qui officia deserunt mollit anim id est laborum consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco.</p>
    <br>
    <h2>TITLE HEADING</h2>
    <h5>Title description, Sep 2, 2017</h5>
    <div class="fakeimg" style="height:200px;">Image</div>
    <p>Some text..</p>
    <p>Sunt in culpa qui officia deserunt mollit anim id est laborum consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco.</p>
  </div>
</div>

<!-- Footer -->
<div class="footer">
  <!-- <h2>Footer</h2> -->
</div>
<script src="d3.js"></script>
<script>
    const url = "http://127.0.0.1:5000/";

    let df_columns;
    async function myFunction() {
        var x, text;
        // Get the value of the input field with id="numb"
        const data = {
            'sql' : document.getElementById("sql").value
        };
        const other_params = {
            headers : { "content-type" : "application/json; charset=UTF-8" },
            body : JSON.stringify(data),
            method : "POST",
            mode : "cors"
        };

        fetch("http://127.0.0.1:5000/api/db", other_params)
            .then(function(response) {
                if (response.ok) {
                    return response.json();
                } else {
                    throw new Error("Could not reach the API: " + response.statusText);
                }
            }).then(function(data) {
                obj = JSON.parse(data)
        
                result = obj
                columns = [];
                for (let [key, value] of Object.entries(result)) {
                    columns.push({name: key, type: value['name']});
                }
                // document.getElementById("p1").innerHTML = columns;
                let selection = d3.select('#content').selectAll('p').data(columns)
                selection.enter().append('p').merge(selection).classed('column', true).text(function(d) { return d.name + " type: " + d.type; });
                selection.exit().remove();
                document.getElementById("sqlerror").innerHTML = "";
            })
            .catch(function(error) {
            document.getElementById("sqlerror").innerHTML = "error with sql";
        });

    


    //   let obj = await (await fetch("http://127.0.0.1:5000/api/v1/resources/books/all")).json()
    //   document.getElementById("columns").innerHTML = obj;
    //   df_columns = obj
    //   for (let key in df_columns){
    //     if(df_columns.hasOwnProperty(key)){
    //         console.log(`${key} : ${df_columns[key]}`)
        
      
    }
</script>

</body>
</html>
